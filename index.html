<!DOCTYPE html>
<html lang="pt-br">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Nosso Cantinho ğŸ’•</title>
Â  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
Â Â 
Â  <style>
Â  Â  body {
Â  Â  Â  font-family: "Quicksand", sans-serif;
Â  Â  Â  background: linear-gradient(to bottom right, #8e1e5c, #d86ca3);
Â  Â  Â  margin: 0;
Â  Â  Â  color: #fff;
Â  Â  Â  text-align: center;
Â  Â  Â  min-height: 100vh;
Â  Â  Â  overflow-x: hidden;
Â  Â  Â  background-size: cover;
Â  Â  Â  background-position: center;
Â  Â  Â  background-attachment: fixed;
Â  Â  }

Â  Â  #intro-screen {
Â  Â  Â  position: fixed;
Â  Â  Â  top: 0;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  background: linear-gradient(to bottom right, #8e1e5c, #d86ca3);
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: center;
Â  Â  Â  z-index: 100;
Â  Â  Â  transition: opacity 1s ease;
Â  Â  Â  text-align: center;
Â  Â  Â  padding: 0 20px;
Â  Â  Â  background-size: cover;
Â  Â  Â  background-position: center;
Â  Â  Â  background-attachment: fixed;
Â  Â  }
Â  Â  #intro-screen.fade-out { opacity: 0; pointer-events: none; }

Â  Â  .intro-quote {
Â  Â  Â  max-width: 600px;
Â  Â  Â  font-size: 1.2em;
Â  Â  Â  font-style: italic;
Â  Â  Â  color: #ffeef6;
Â  Â  Â  margin-top: 20px;
Â  Â  Â  animation: fadeInUp 3s ease;
Â  Â  Â  opacity: 0.9;
Â  Â  }

Â  Â  .intro-buttons {
Â  Â  Â  margin-top: 40px;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  gap: 15px;
Â  Â  }
Â  Â  #musicBtn, #enterBtn {
Â  Â  Â  background: #ff5c8d;
Â  Â  Â  border: none;
Â  Â  Â  padding: 12px 25px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  color: #fff;
Â  Â  Â  font-weight: bold;
Â  Â  Â  font-size: 1em;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: background 0.3s;
Â  Â  }
Â  Â  #musicBtn:hover, #enterBtn:hover { background: #e64c7c; }

Â  Â  .heart {
Â  Â  Â  position: relative;
Â  Â  Â  width: 100px;
Â  Â  Â  height: 90px;
Â  Â  Â  background: #ff5c8d;
Â  Â  Â  transform: rotate(-45deg);
Â  Â  Â  animation: pulse 1.2s infinite;
Â  Â  }
Â  Â  .heart::before, .heart::after {
Â  Â  Â  content: "";
Â  Â  Â  position: absolute;
Â  Â  Â  width: 100px;
Â  Â  Â  height: 90px;
Â  Â  Â  background: #ff5c8d;
Â  Â  Â  border-radius: 50%;
Â  Â  }
Â  Â  .heart::before { top: -50px; left: 0; }
Â  Â  .heart::after { left: 50px; top: 0; }
Â  Â  @keyframes pulse {
Â  Â  Â  0%, 100% { transform: scale(1) rotate(-45deg); }
Â  Â  Â  50% { transform: scale(1.1) rotate(-45deg); }
Â  Â  }

Â  Â  header {
Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  padding: 25px;
Â  Â  Â  box-shadow: 0 0 15px rgba(255, 182, 193, 0.5);
Â  Â  }
Â  Â  h1 {
Â  Â  Â  font-family: "Dancing Script", cursive;
Â  Â  Â  font-size: 2.8em;
Â  Â  Â  color: #fff;
Â  Â  }
Â  Â  #editBtn {
Â  Â  Â  background: #ff5c8d;
Â  Â  Â  border: none;
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  color: #fff;
Â  Â  Â  font-weight: bold;
Â  Â  }
Â  Â  #editBtn:hover { background: #e64c7c; }

Â  Â  #gallery {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: repeat(2, 1fr);
Â  Â  Â  gap: 15px;Â 
Â  Â  Â  width: 90%;Â 
Â  Â  Â  max-width: 900px;Â 
Â  Â  Â  margin: 20px auto;Â 
Â  Â  Â  padding: 10px;
Â  Â  Â  box-sizing: border-box;
Â  Â  Â  min-height: 50vh;
Â  Â  }

Â  Â  .photo {
Â  Â  Â  position: relative;Â 
Â  Â  Â  width: 100%;
Â  Â  Â  opacity: 1;
Â  Â  Â  display: block;
Â  Â  Â  aspect-ratio: 1 / 1;Â 
Â  Â  Â  border-radius: 10px;Â 
Â  Â  Â  overflow: hidden;Â 
Â  Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
Â  Â  }
Â  Â  .photo img {
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  object-fit: cover;Â 
Â  Â  Â  display: block;
Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  .caption {
Â  Â  Â  position: absolute;
Â  Â  Â  bottom: 0;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  text-align: center;
Â  Â  Â  font-size: 1em;
Â  Â  Â  color: #fff;
Â  Â  Â  background: rgba(0,0,0,0.6);
Â  Â  Â  padding: 5px;
Â  Â  Â  box-sizing: border-box;
Â  Â  }

Â  Â  .navigation-buttons {
Â  Â  Â  display: none;
Â  Â  }

Â  Â  .delete-btn {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 10px;
Â  Â  Â  right: 10px;
Â  Â  Â  background: #ff3b3b;
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  width: 30px;
Â  Â  Â  height: 30px;
Â  Â  Â  font-size: 1.2em;
Â  Â  Â  font-weight: bold;
Â  Â  Â  cursor: pointer;
Â  Â  Â  z-index: 10;
Â  Â  Â  display: none;Â 
Â  Â  }

Â  Â  #main-content.edit-mode-active .delete-btn {
Â  Â  Â  display: block;
Â  Â  }

Â  Â  #editor {
Â  Â  Â  background: rgba(255, 255, 255, 0.15);
Â  Â  Â  padding: 20px;
Â  Â  Â  margin: 20px auto;
Â  Â  Â  width: 90%;
Â  Â  Â  max-width: 400px;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  box-shadow: 0 0 8px rgba(255,255,255,0.3);
Â  Â  }
Â  Â  #editor input, #editor button {
Â  Â  Â  margin-top: 10px;
Â  Â  Â  padding: 10px;
Â  Â  Â  width: 80%;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  border: none;
Â  Â  Â  font-size: 1em;
Â  Â  }
Â  Â  #addPhoto {
Â  Â  Â  background: #ff5c8d;
Â  Â  Â  border: none;
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  color: #fff;
Â  Â  Â  font-weight: bold;
Â  Â  }
Â  Â  #addPhoto:hover { background: #e64c7c; }

Â  Â  footer {
Â  Â  Â  margin-top: 40px;
Â  Â  Â  font-size: 0.9em;
Â  Â  Â  opacity: 0.8;
Â  Â  }
Â  Â  .hidden { display: none; }

Â  Â  @keyframes fadeInUp {
Â  Â  Â  from { opacity: 0; transform: translateY(20px); }
Â  Â  Â  to { opacity: 1; transform: translateY(0); }
Â  Â  }

Â  Â  #lightbox {
Â  Â  Â  position: fixed;
Â  Â  Â  top: 0;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  background: rgba(0, 0, 0, 0.8);
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: center;
Â  Â  Â  z-index: 1000;Â 
Â  Â  Â  opacity: 0;
Â  Â  Â  pointer-events: none;
Â  Â  Â  transition: opacity 0.3s ease;
Â  Â  }

Â  Â  #lightbox.visible {
Â  Â  Â  opacity: 1;
Â  Â  Â  pointer-events: all;
Â  Â  }

Â  Â  .lightbox-content {
Â  Â  Â  position: relative;
Â  Â  Â  background: #fff;
Â  Â  Â  padding: 20px;
Â  Â  Â  border-radius: 15px;
Â  Â  Â  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
Â  Â  Â  max-width: 90%;
Â  Â  Â  max-height: 90%;
Â  Â  Â  overflow: hidden;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center;
Â  Â  }

Â  Â  #lightbox-img {
Â  Â  Â  max-width: 100%;
Â  Â  Â  max-height: 80vh;Â 
Â  Â  Â  display: block;
Â  Â  Â  object-fit: contain;
Â  Â  Â  border-radius: 10px;
Â  Â  }

Â  Â  #lightbox-caption {
Â  Â  Â  margin-top: 15px;
Â  Â  Â  font-size: 1.1em;
Â  Â  Â  color: #333;
Â  Â  Â  text-align: center;
Â  Â  Â  max-width: 100%;
Â  Â  Â  word-wrap: break-word;Â 
Â  Â  }

Â  Â  .close-lightbox {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 10px;
Â  Â  Â  right: 20px;
Â  Â  Â  color: #555;
Â  Â  Â  font-size: 30px;
Â  Â  Â  font-weight: bold;
Â  Â  Â  cursor: pointer;
Â  Â  Â  z-index: 1001;
Â  Â  }

Â  Â  .close-lightbox:hover {
Â  Â  Â  color: #ff3b3b;
Â  Â  }

Â  Â  @media (max-width: 600px) {
Â  Â  Â  #gallery {
Â  Â  Â  Â  grid-template-columns: repeat(1, 1fr);Â 
Â  Â  Â  }
Â  Â  Â  .photo {
Â  Â  Â  Â  aspect-ratio: auto;Â 
Â  Â  Â  }
Â  Â  }

Â  Â  .caption .music-link-icon {
Â  Â  Â  text-decoration: none;
Â  Â  Â  font-size: 1.1em;
Â  Â  Â  margin-left: 5px;
Â  Â  Â  cursor: pointer;Â 
Â  Â  }

Â  Â  .caption .music-link-icon:hover {
Â  Â  Â  opacity: 0.7;
Â  Â  }

Â  Â  .lightbox-music-link {
Â  Â  Â  display: block;
Â  Â  Â  margin-top: 10px;
Â  Â  Â  padding: 8px 12px;
Â  Â  Â  background-color: #f0f0f0;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  color: #8e1e5c;
Â  Â  Â  font-weight: bold;
Â  Â  Â  text-decoration: none;
Â  Â  Â  transition: background-color 0.3s;
Â  Â  }

Â  Â  .lightbox-music-link:hover {
Â  Â  Â  background-color: #e0e0e0;
Â  Â  Â  text-decoration: none;
Â  Â  }

Â  Â  #pagination-controls {
Â  Â  Â  margin: 20px 0;
Â  Â  Â  text-align: center;
Â  Â  }
Â  Â  .page-btn, .nav-btn {
Â  Â  Â  background: #ff5c8d;
Â  Â  Â  border: none;
Â  Â  Â  padding: 8px 14px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  color: #fff;
Â  Â  Â  font-weight: bold;
Â  Â  Â  font-size: 1em;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: background 0.3s;
Â  Â  Â  margin: 0 4px;
Â  Â  }
Â  Â  .page-btn:hover, .nav-btn:hover {
Â  Â  Â  background: #e64c7c;
Â  Â  }
Â  Â  .page-btn.active {
Â  Â  Â  background: #b33c6a;
Â  Â  Â  cursor: default;
Â  Â  }
Â  Â  .nav-btn:disabled {
Â  Â  Â  background: #aaa;
Â  Â  Â  cursor: not-allowed;
Â  Â  }

Â  Â  .lightbox-nav {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 50%;
Â  Â  Â  transform: translateY(-50%);
Â  Â  Â  background: rgba(255, 255, 255, 0.3);
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  width: 40px;
Â  Â  Â  height: 40px;
Â  Â  Â  font-size: 1.5em;
Â  Â  Â  color: white;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: background 0.3s;
Â  Â  Â  z-index: 1002;
Â  Â  }
Â  Â  .lightbox-nav:hover {
Â  Â  Â  background: rgba(255, 255, 255, 0.6);
Â  Â  }
Â  Â  .lightbox-nav:disabled {
Â  Â  Â  background: rgba(255, 255, 255, 0.1);
Â  Â  Â  color: #999;
Â  Â  Â  cursor: not-allowed;
Â  Â  }
Â  Â  #lightbox-prev {
Â  Â  Â  left: 30px;
Â  Â  }
Â  Â  #lightbox-next {
Â  Â  Â  right: 30px;
Â  Â  }

Â  Â  #spotify-player {
Â  Â  Â  position: fixed;
Â  Â  Â  bottom: 15px;
Â  Â  Â  right: 15px;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
Â  Â  Â  z-index: 999;
Â  Â  Â  cursor: move;
Â  Â  }
Â  Â  #spotify-status {
Â  Â  Â  margin-top: 10px;
Â  Â  Â  font-size: 0.95rem;
Â  Â  Â  color: #444;
Â  Â  }
Â  </style>
</head>
<body>
Â Â 
Â  <div id="intro-screen">
Â  Â  <div class="heart"></div>
Â  Â  <h1>Bem-vindo(a) ao Nosso Cantinho ğŸ’–</h1>
Â  Â  <p class="intro-quote">
Â  Â  Â  "VocÃª transforma tudo Ã  minha volta em um mundo colorido, obrigada por acender a luz."
Â  Â  </p>
Â  Â  <div class="intro-buttons">
Â  Â  Â  <button id="enterBtn">Entrar</button>
Â  Â  </div>
Â  </div>

Â  <div id="main-content" class="hidden">
Â  Â  <header>
Â  Â  Â  <h1>Nosso Cantinho ğŸ’•</h1>
Â  Â  Â  <button id="editBtn">Modo EdiÃ§Ã£o</button>
Â  Â  </header>

Â  Â  <main id="gallery">
Â  Â  Â  <div class="navigation-buttons">
Â  Â  Â  Â  <button id="prevBtn">â†</button>
Â  Â  Â  Â  <button id="nextBtn">â†’</button>
Â  Â  Â  </div>
Â  Â  </main>

Â  Â  <div id="pagination-controls"></div>

Â  Â  <footer>
Â  Â  Â  <p>Feito com ğŸ’—. Sou inteiramente sua.</p>
Â  Â  </footer>

Â  Â  <div id="editor" class="hidden">
Â  Â  Â  <h2>Adicionar nova lembranÃ§a</h2>
Â  Â  Â  <input type="file" id="imageInput" accept="image/*">
Â  Â  Â  <input type="text" id="captionInput" placeholder="Legenda da foto">
Â  Â  Â  <input type="text" id="musicLinkInput" placeholder="Link da mÃºsica (opcional)">
Â  Â  Â  <button id="addPhoto">Adicionar</button>

Â  Â  Â  <hr style="border-color: rgba(255,255,255,0.2); margin: 20px 0;">
Â  Â  Â  <h2>Alterar Fundo da PÃ¡gina</h2>
Â  Â  Â  <input type="file" id="bgImageInput" accept="image/*">
Â  Â  Â  <button id="changeBgBtn">Salvar Fundo</button>
Â  Â  Â  <button id="removeBgBtn" style="background-color: #ff3b3b; margin-top: 5px;">Remover Fundo</button>
Â  Â  </div>
Â  </div>

Â  <iframe
Â  Â  id="spotify-player"
Â  Â  style="border-radius:12px"
Â  Â  src="https://open.spotify.com/embed/playlist/37i9dQZF1DXcBWIGoYBM5M?utm_source=generator"
Â  Â  width="250" 
Â  Â  height="80" 
Â  Â  frameBorder="0" 
Â  Â  allowfullscreen="" 
Â  Â  allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
Â  Â  loading="lazy">
Â  </iframe>

Â  <div id="lightbox" class="hidden">
Â  Â  <div class="lightbox-content">
Â  Â  Â  <span class="close-lightbox">Ã—</span>
Â  Â  Â Â 
Â  Â  Â  <button id="lightbox-prev" class="lightbox-nav">â†</button>
Â  Â  Â  <img id="lightbox-img" src="" alt="Foto Ampliada">
Â  Â  Â  <button id="lightbox-next" class="lightbox-nav">â†’</button>
Â  Â  Â Â 
Â  Â  Â  <div id="lightbox-caption"></div>
Â  Â  </div>
Â  </div>

Â  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
Â  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

Â  <script>
Â  Â  const firebaseConfig = {
Â  Â  Â  apiKey: "AIzaSyBnx2V3kPc9U94qJoEsV-eIaoAChR7ety0",
Â  Â  Â  authDomain: "inteiramene-sua.firebaseapp.com",
Â  Â  Â  databaseURL: "https://inteiramene-sua-default-rtdb.firebaseio.com",
Â  Â  Â  projectId: "inteiramene-sua",
Â  Â  Â  storageBucket: "inteiramene-sua.firebasestorage.app",
Â  Â  Â  messagingSenderId: "801226819273",
Â  Â  Â  appId: "1:801226819273:web:107cc21e7e687a1d7a2f18",
Â  Â  Â  measurementId: "G-HTCHMNYKTF"
Â  Â  };

Â  Â  firebase.initializeApp(firebaseConfig);

Â  Â  const db = firebase.firestore();
Â  Â  const photosCollection = db.collection("photos");
Â  Â  const settingsDoc = db.collection("settings").doc("appSettings");
Â  </script>

Â  <script>
Â  Â  const gallery = document.getElementById('gallery');
Â  Â  const editor = document.getElementById('editor');
Â  Â  const editBtn = document.getElementById('editBtn');
Â  Â  const addPhotoBtn = document.getElementById('addPhoto');
Â  Â  const introScreen = document.getElementById('intro-screen');
Â  Â  const enterBtn = document.getElementById('enterBtn');
Â  Â  const mainContent = document.getElementById('main-content');
Â  Â  const spotifyPlayer = document.getElementById('spotify-player');

Â  Â  const lightbox = document.getElementById('lightbox');
Â  Â  const lightboxImg = document.getElementById('lightbox-img');
Â  Â  const lightboxCaption = document.getElementById('lightbox-caption');
Â  Â  const closeLightboxBtn = document.querySelector('.close-lightbox');

Â  Â  const musicLinkInput = document.getElementById('musicLinkInput');

Â  Â  const bgImageInput = document.getElementById('bgImageInput');
Â  Â  const changeBgBtn = document.getElementById('changeBgBtn');
Â  Â  const removeBgBtn = document.getElementById('removeBgBtn');

Â  Â  const paginationControls = document.getElementById('pagination-controls');

Â  Â  const lightboxPrevBtn = document.getElementById('lightbox-prev');
Â  Â  const lightboxNextBtn = document.getElementById('lightbox-next');

Â  Â  let photos = [];
Â  Â  let currentPage = 1;
Â  Â  const photosPerPage = 4;
Â  Â  let currentLightboxIndex = 0;

Â  Â  const CLOUD_NAME = "doplrv465";
Â  Â  const UPLOAD_PRESET = "meudengo";

Â  Â  const bgGradient = "linear-gradient(to bottom right, rgba(142, 30, 92, 0.8), rgba(216, 108, 163, 0.8))";
Â  Â  const bgGradientSolid = "linear-gradient(to bottom right, #8e1e5c, #d86ca3)";

Â  Â  function applyBackground(imageUrl) {
Â  Â  Â  const bgValue = imageUrl ? `${bgGradient}, url(${imageUrl})` : bgGradientSolid;

Â  Â  Â  document.body.style.background = bgValue;
Â  Â  Â  introScreen.style.background = bgValue;
Â  Â  Â Â 
Â  Â  Â  const styles = {
Â  Â  Â  Â  backgroundSize: 'cover',
Â  Â  Â  Â  backgroundPosition: 'center',
Â  Â  Â  Â  backgroundAttachment: 'fixed'
Â  Â  Â  };
Â  Â  Â Â 
Â  Â  Â  Object.assign(document.body.style, styles);
Â  Â  Â  Object.assign(introScreen.style, styles);
Â  Â  }

Â  Â  async function loadSettings() {
Â  Â  Â  try {
Â  Â  Â  Â  const doc = await settingsDoc.get();
Â  Â  Â  Â  if (doc.exists && doc.data().backgroundImageUrl) {
Â  Â  Â  Â  Â  applyBackground(doc.data().backgroundImageUrl);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  removeBackground();Â 
Â  Â  Â  Â  }
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Erro ao carregar configuraÃ§Ãµes:", error);
Â  Â  Â  Â  removeBackground();
Â  Â  Â  }
Â  Â  }

Â  Â  async function removeBackground() {
Â  Â  Â  applyBackground(null);
Â  Â  Â Â 
Â  Â  Â  try {
Â  Â  Â  Â  await settingsDoc.set({ backgroundImageUrl: null }, { merge: true });
Â  Â  Â  Â  alert("Fundo removido com sucesso!");
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Erro ao remover fundo:", error);
Â  Â  Â  Â  alert("Erro ao remover fundo do Firebase.");
Â  Â  Â  }
Â  Â  }

Â  Â  async function loadPhotos() {
Â  Â  Â  try {
Â  Â  Â  Â  const snapshot = await photosCollection.orderBy('timestamp', 'desc').get();
Â  Â  Â  Â Â 
Â  Â  Â  Â  photos = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

Â  Â  Â  Â  renderGalleryAndPagination();Â 
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Erro ao carregar fotos:", error);
Â  Â  Â  Â  alert("Erro ao carregar fotos da nuvem.");
Â  Â  Â  }
Â  Â  }

Â  Â  async function deletePhoto(photoId) {
Â  Â  Â  try {
Â  Â  Â  Â  await photosCollection.doc(photoId).delete();
Â  Â  Â  Â  await loadPhotos();Â 
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Erro ao deletar foto:", error);
Â  Â  Â  Â  alert("Erro ao deletar foto da nuvem.");
Â  Â  Â  }
Â  Â  }

Â  Â  function renderGalleryAndPagination() {
Â  Â  Â  gallery.innerHTML = '';
Â  Â  Â  paginationControls.innerHTML = '';

Â  Â  Â  const totalPages = Math.ceil(photos.length / photosPerPage);

Â  Â  Â  if (currentPage > totalPages) {
Â  Â  Â  Â  currentPage = totalPages;
Â  Â  Â  }
Â  Â  Â  if (currentPage < 1) {
Â  Â  Â  Â  currentPage = 1;
Â  Â  Â  }

Â  Â  Â  const startIndex = (currentPage - 1) * photosPerPage;
Â  Â  Â  const endIndex = startIndex + photosPerPage;
Â  Â  Â  const photosToShow = photos.slice(startIndex, endIndex);

Â  Â  Â  photosToShow.forEach(photo => {
Â  Â  Â  Â  const originalIndex = photos.findIndex(p => p.id === photo.id);
Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  div.className = 'photo';
Â  Â  Â  Â Â 
Â  Â  Â  Â  const musicIconHTML = photo.musicLinkÂ 
Â  Â  Â  Â  Â  ? `<a href="${photo.musicLink}" target="_blank" class="music-link-icon">ğŸµ</a>`Â 
Â  Â  Â  Â  Â  : '';

Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  <button class="delete-btn" data-id="${photo.id}">Ã—</button>
Â  Â  Â  Â  Â  <img src="${photo.url}" alt="${photo.caption}" data-id="${photo.id}" data-index-in-page="${originalIndex}">
Â  Â  Â  Â  Â  <div class="caption">${photo.caption} ${musicIconHTML}</div>`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  gallery.appendChild(div);
Â  Â  Â  });

Â  Â  Â  setupPagination(totalPages);
Â  Â  Â  setupLightboxListeners();
Â  Â  }

Â  Â  function showLightboxPhoto(index) {
Â  Â  Â  currentLightboxIndex = index;
Â  Â  Â  const photo = photos[index];

Â  Â  Â  if (!photo) return;

Â  Â  Â  lightboxImg.src = photo.url;
Â  Â  Â  lightboxCaption.innerHTML = `<div>${photo.caption}</div>`;

Â  Â  Â  if (photo.musicLink) {
Â  Â  Â  Â  lightboxCaption.innerHTML += `<a href="${photo.musicLink}" target="_blank" class="lightbox-music-link">Ouvir mÃºsica ğŸµ</a>`;
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  lightboxPrevBtn.disabled = (index === 0);
Â  Â  Â  lightboxNextBtn.disabled = (index === photos.length - 1);
Â  Â  }

Â  Â  function setupLightboxListeners() {
Â  Â  Â  document.querySelectorAll('.photo img').forEach(img => {
Â  Â  Â  Â  img.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  e.stopPropagation();Â 
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  const photoId = e.target.getAttribute('data-id');
Â  Â  Â  Â  Â  const originalIndex = photos.findIndex(p => p.id === photoId);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  showLightboxPhoto(originalIndex);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  lightbox.classList.add('visible');
Â  Â  Â  Â  });
Â  Â  Â  });

Â  Â  Â  document.querySelectorAll('.music-link-icon').forEach(icon => {
Â  Â  Â  Â  icon.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  }

Â  Â  function setupPagination(totalPages) {
Â  Â  Â  if (totalPages <= 1) return;

Â  Â  Â  const prevBtn = document.createElement('button');
Â  Â  Â  prevBtn.textContent = 'â†';
Â  Â  Â  prevBtn.className = 'nav-btn';
Â  Â  Â  prevBtn.disabled = currentPage === 1;
Â  Â  Â  prevBtn.addEventListener('click', () => {
Â  Â  Â  Â  if (currentPage > 1) {
Â  Â  Â  Â  Â  currentPage--;
Â  Â  Â  Â  Â  renderGalleryAndPagination();
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â  paginationControls.appendChild(prevBtn);

Â  Â  Â  for (let i = 1; i <= totalPages; i++) {
Â  Â  Â  Â  const pageBtn = document.createElement('button');
Â  Â  Â  Â  pageBtn.textContent = i;
Â  Â  Â  Â  pageBtn.className = 'page-btn';
Â  Â  Â  Â  if (i === currentPage) {
Â  Â  Â  Â  Â  pageBtn.classList.add('active');
Â  Â  Â  Â  }
Â  Â  Â  Â  pageBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  currentPage = i;
Â  Â  Â  Â  Â  renderGalleryAndPagination();
Â  Â  Â  Â  });
Â  Â  Â  Â  paginationControls.appendChild(pageBtn);
Â  Â  Â  }

Â  Â  Â  const nextBtn = document.createElement('button');
Â  Â  Â  nextBtn.textContent = 'â†’';
Â  Â  Â  nextBtn.className = 'nav-btn';
Â  Â  Â  nextBtn.disabled = currentPage === totalPages;
Â  Â  Â  nextBtn.addEventListener('click', () => {
Â  Â  Â  Â  if (currentPage < totalPages) {
Â  Â  Â  Â  Â  currentPage++;
Â  Â  Â  Â  Â  renderGalleryAndPagination();
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â  paginationControls.appendChild(nextBtn);
Â  Â  }

Â  Â  function changePage(newPage) {
Â  Â  Â  currentPage = newPage;
Â  Â  Â  renderGalleryAndPagination();
Â  Â  }

Â  Â  enterBtn.addEventListener('click', () => {
Â  Â  Â  introScreen.classList.add('fade-out');
Â  Â  Â Â 
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  introScreen.style.display = 'none';
Â  Â  Â  Â  mainContent.classList.remove('hidden');
Â  Â  Â  Â Â 
Â  Â  Â  Â  loadPhotos();Â 
Â  Â  Â  }, 1000);
Â  Â  });

Â  Â  editBtn.addEventListener('click', () => {
Â  Â  Â  const senha = prompt("Digite a senha para editar:");
Â  Â  Â  if (senha === "meuamorzinho") {
Â  Â  Â  Â  editor.classList.toggle('hidden');
Â  Â  Â  Â  mainContent.classList.toggle('edit-mode-active');
Â  Â  Â  } else {
Â  Â  Â  Â  alert("Senha incorreta ğŸ’”");
Â  Â  Â  }
Â  Â  });

Â  Â  addPhotoBtn.addEventListener('click', () => {
Â  Â  Â  const fileInput = document.getElementById('imageInput');
Â  Â  Â  const captionInput = document.getElementById('captionInput');
Â  Â  Â  const file = fileInput.files[0];
Â  Â  Â  const caption = captionInput.value;
Â  Â  Â  const musicLink = musicLinkInput.value;

Â  Â  Â  if (!file) {
Â  Â  Â  Â  alert("Selecione uma imagem ğŸ’");
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (!caption) {
Â  Â  Â  Â  alert("Adicione uma legenda! ğŸ’");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  addPhotoBtn.disabled = true;
Â  Â  Â  addPhotoBtn.textContent = 'Enviando...';

Â  Â  Â  const reader = new FileReader();
Â  Â  Â  reader.onload = e => {
Â  Â  Â  Â  resizeAndUpload(e.target.result, file.type, caption, musicLink, addPhotoBtn);
Â  Â  Â  };
Â  Â  Â  reader.readAsDataURL(file);
Â  Â  });

Â  Â  async function uploadToCloudinary(base64Image) {
Â  Â  Â  const url = `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`;
Â  Â  Â Â 
Â  Â  Â  const formData = new FormData();
Â  Â  Â  formData.append('file', base64Image);
Â  Â  Â  formData.append('upload_preset', UPLOAD_PRESET);

Â  Â  Â  const response = await fetch(url, {
Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  body: formData,
Â  Â  Â  });

Â  Â  Â  const data = await response.json();
Â  Â  Â  if (data.secure_url) {
Â  Â  Â  Â  return data.secure_url;
Â  Â  Â  } else {
Â  Â  Â  Â  throw new Error('Cloudinary upload failed: ' + (data.error ? data.error.message : 'Unknown error'));
Â  Â  Â  }
Â  Â  }

Â  Â  function resizeAndUpload(dataURL, mimeType, caption, musicLink, button) {
Â  Â  Â  const MAX_WIDTH = 1920;
Â  Â  Â  const MAX_HEIGHT = 1080;
Â  Â  Â Â 
Â  Â  Â  const img = new Image();
Â  Â  Â  img.src = dataURL;
Â  Â  Â Â 
Â  Â  Â  img.onload = async () => {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  let width = img.width;
Â  Â  Â  Â  Â  Â  let height = img.height;

Â  Â  Â  Â  Â  Â  if (width > height) {
Â  Â  Â  Â  Â  Â  Â  if (width > MAX_WIDTH) {
Â  Â  Â  Â  Â  Â  Â  Â  height = height * (MAX_WIDTH / width);
Â  Â  Â  Â  Â  Â  Â  Â  width = MAX_WIDTH;
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  if (height > MAX_HEIGHT) {
Â  Â  Â  Â  Â  Â  Â  Â  width = width * (MAX_HEIGHT / height);
Â  Â  Â  Â  Â  Â  Â  Â  height = MAX_HEIGHT;
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const canvas = document.createElement('canvas');
Â  Â  Â  Â  Â  Â  canvas.width = width;
Â  Â  Â  Â  Â  Â  canvas.height = height;
Â  Â  Â  Â  Â  Â  const ctx = canvas.getContext('2d');
Â  Â  Â  Â  Â  Â  ctx.drawImage(img, 0, 0, width, height);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const resizedBase64 = canvas.toDataURL('image/jpeg', 0.8);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const downloadURL = await uploadToCloudinary(resizedBase64);

Â  Â  Â  Â  Â  Â  await photosCollection.add({
Â  Â  Â  Â  Â  Â  Â  Â  url: downloadURL,
Â  Â  Â  Â  Â  Â  Â  Â  caption: caption,
Â  Â  Â  Â  Â  Â  Â  Â  musicLink: musicLink,
L Â  Â  Â  Â  Â  Â  Â  timestamp: firebase.firestore.FieldValue.serverTimestamp()
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  alert("Foto adicionada com sucesso! (VisÃ­vel para todos)");
L Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('imageInput').value = '';
Â  Â  Â  Â  Â  Â  document.getElementById('captionInput').value = '';
Â  Â  Â  Â  Â  Â  musicLinkInput.value = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  currentPage = 1;
Â  Â  Â  Â  Â  Â  await loadPhotos();
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error("Erro ao subir a foto:", error);
Â  Â  Â  Â  Â  Â  alert("Erro ao enviar a foto para a nuvem. Verifique o console para detalhes.");
Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  button.disabled = false;
Â  Â  Â  Â  Â  Â  button.textContent = 'Adicionar';
Â  Â  Â  Â  }
Â  Â  Â  };
Â  Â  }

Â  Â  gallery.addEventListener('click', (e) => {
Â  Â  Â  if (e.target.classList.contains('delete-btn')) {
Â  Â  Â  Â  if (!confirm("Tem certeza que quer apagar esta foto? Esta aÃ§Ã£o nÃ£o pode ser desfeita.")) {
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const photoId = e.target.getAttribute('data-id');
Â  Â  Â  Â  deletePhoto(photoId);
Â  Â  Â  }
Â  Â  });

Â  Â  lightboxPrevBtn.addEventListener('click', (e) => {
Â  Â  Â  e.stopPropagation();
Â  Â  Â  if (currentLightboxIndex > 0) {
Â  Â  Â  Â  showLightboxPhoto(currentLightboxIndex - 1);
Â  Â  Â  }
Â  Â  });

Â  Â  lightboxNextBtn.addEventListener('click', (e) => {
Â  Â  Â  e.stopPropagation();
Â  Â  Â  if (currentLightboxIndex < photos.length - 1) {
Â  Â  Â  Â  showLightboxPhoto(currentLightboxIndex + 1);
Â  Â  Â  }
Â  Â  });

Â  Â  closeLightboxBtn.addEventListener('click', () => {
Â  Â  Â  lightbox.classList.remove('visible');
Â  Â  });

Â  Â  lightbox.addEventListener('click', (e) => {
Â  Â  Â  if (e.target.id === 'lightbox') {
Â  Â  Â  Â  lightbox.classList.remove('visible');
Â  Â  Â  }
Â  Â  });

Â  Â  changeBgBtn.addEventListener('click', async () => {
Â  Â  Â  const file = bgImageInput.files[0];
Â  Â  Â  if (!file) {
Â  Â  Â  Â  alert("Selecione uma imagem de fundo.");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  changeBgBtn.disabled = true;
Â  Â  Â  changeBgBtn.textContent = 'Enviando...';

Â  Â  Â  const reader = new FileReader();
Â  Â  Â  reader.onload = async e => {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const MAX_BG_WIDTH = 1920;
Â  Â  Â  Â  Â  Â  const resizedUrl = await new Promise(resolve => {
Â  Â  Â  Â  Â  Â  Â  Â  const img = new Image();
Â  Â  Â  Â  Â  Â  Â  Â  img.onload = async () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const canvas = document.createElement('canvas');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let width = img.width;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let height = img.height;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (width > MAX_BG_WIDTH) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  height = height * (MAX_BG_WIDTH / width);
i Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width = MAX_BG_WIDTH;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  canvas.width = width;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  canvas.height = height;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  canvas.getContext('2d').drawImage(img, 0, 0, width, height);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const base64Image = canvas.toDataURL('image/jpeg', 0.6);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const downloadURL = await uploadToCloudinary(base64Image);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resolve(downloadURL);
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  img.src = e.target.result;
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  await settingsDoc.set({ backgroundImageUrl: resizedUrl }, { merge: true });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  applyBackground(resizedUrl);
Â  Â  Â  Â  Â  Â  alert("Fundo alterado com sucesso! VisÃ­vel para todos.");
Â  Â  Â  Â  Â  Â  bgImageInput.value = '';
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error("Erro ao alterar fundo:", error);
s Â  Â  Â  Â  Â  alert("Erro ao alterar fundo.");
Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  changeBgBtn.disabled = false;
Â  Â  Â  Â  Â  Â  changeBgBtn.textContent = 'Salvar Fundo';
Â  Â  Â  Â  }
Â  Â  Â  };
Â  Â  Â  reader.readAsDataURL(file);
Â  Â  });


Â  Â  removeBgBtn.addEventListener('click', () => {
Â  Â  Â  if (confirm("Tem certeza que quer remover o fundo personalizado?")) {
Â  Â  Â  Â  removeBackground();
Â  Â  Â  }
Â  Â  });

Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â loadSettings();Â 
Â  Â  });
Â  Â  
Â  Â  let isDragging = false;
Â  Â  let startX, startY, startLeft, startTop;

all Â  function startDrag(e) {
Â  Â  Â  isDragging = true;
Â  Â  Â  const event = e.touches ? e.touches[0] : e;
Â  Â  Â Â 
Â  Â  Â  startX = event.clientX;
Â  Â  Â  startY = event.clientY;

Â  Â  Â  const rect = spotifyPlayer.getBoundingClientRect();
Â  Â  Â  startLeft = rect.left;
Â  Â  Â  startTop = rect.top;

s Â  Â  spotifyPlayer.style.right = 'auto';
Â  Â  Â  spotifyPlayer.style.bottom = 'auto';
Â  Â  Â  spotifyPlayer.style.left = startLeft + 'px';
Â  Â  Â  spotifyPlayer.style.top = startTop + 'px';

Â  Â  Â  spotifyPlayer.style.pointerEvents = 'none';
Â  Â  Â  document.body.style.userSelect = 'none';
Â  Â  }

Â  Â  function doDrag(e) {
Â  Â  Â  if (!isDragging) return;
Â  Â  Â  if (e.touches) e.preventDefault();
Â  Â  Â  const event = e.touches ? e.touches[0] : e;
Â  Â  Â Â 
Â  Â  Â  let deltaX = event.clientX - startX;
Â  Â  Â  let deltaY = event.clientY - startY;

Â  Â  Â  spotifyPlayer.style.left = (startLeft + deltaX) + 'px';
Ind Â  Â  spotifyPlayer.style.top = (startTop + deltaY) + 'px';
Â  Â  }

Â  Â  function stopDrag() {
Â  Â  Â  if (!isDragging) return;
Â  Â  Â  isDragging = false;
Â  Â  Â  spotifyPlayer.style.pointerEvents = 'auto';
Â  Â  Â  document.body.style.userSelect = 'auto';
Â  Â  }

Â  Â  spotifyPlayer.addEventListener('mousedown', startDrag);
Â  Â  document.addEventListener('mousemove', doDrag);
Â  Â  document.addEventListener('mouseup', stopDrag);

Â  Â  spotifyPlayer.addEventListener('touchstart', startDrag);
Â  Â  document.addEventListener('touchmove', doDrag, { passive: false }); 
ci Â  document.addEventListener('touchend', stopDrag);
Â  Â  document.addEventListener('touchcancel', stopDrag);
Â  </script>
</body>
</html>
